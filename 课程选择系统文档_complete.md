# 课程选择系统文档

## 前言

课程选择系统是一个使用现代技术栈设计和实现的综合学生课程管理应用程序。该系统采用微服务架构模式，后端使用 FastAPI（Python），前端使用 Vue3 和 Ant Design。该系统为教育机构的课程选择、管理和管理提供了完整的解决方案。

本文档遵循软件开发的系统方法，从需求分析到系统实现和测试。该系统支持多用户角色，包括学生、教师和管理员，每个角色都有特定的功能和访问控制。主要功能包括双因素身份验证（2FA）、速率限制、基于角色的访问控制和双重通信模式（HTTP 和 socket）。

该系统在设计时考虑了可扩展性、安全性和可维护性，采用了最佳实践，如基于令牌的身份验证、数据库复制支持和全面的测试程序。此文档是了解、实施和维护课程选择系统的综合指南。

## 一、课程选择系统需求分析

### 1、系统功能简述

课程选择系统旨在管理教育机构中复杂的课程注册过程。该系统提供了一个中心平台，学生可以在其中浏览可用课程，根据学术要求选择课程，并管理课程表。教师可以创建、修改和管理课程，并管理学生注册。管理员可以管理用户、生成注册代码并监督整个系统运行。

### 2、需求规格

#### 2.1 功能需求

**学生模块：**
- 使用用户名/密码和双因素身份验证（2FA）进行用户身份验证
- 课程浏览和过滤功能
- 课程选择和容量检查
- 课程表查看和管理
- 课程退选功能
- 个人信息管理

**教师模块：**
- 课程 CRUD（创建、读取、更新、删除）操作
- 学生注册管理
- 课程容量和时间表修改
- 学生成绩跟踪
- 课程统计和分析
- 从 CSV 导入学生名单

**管理员模块：**
- 用户管理（学生、教师、管理员）
- 生成用户注册码
- 系统配置管理
- 用户活动监控
- 数据库管理工具
- 系统健康监控

**身份验证模块：**
- 基于 JWT 的令牌身份验证
- 刷新令牌机制
- 用于增强安全性的双因素身份验证（2FA）
- 会话管理
- 密码重置功能
- 账户锁定机制

**队列管理模块：**
- 使用令牌桶算法进行速率限制
- 高流量期间的请求排队
- 公平处理课程选择请求
- 不同用户角色的优先级管理
- 队列请求的自动处理

#### 2.2 非功能需求

**性能需求：**
- 支持在注册高峰期的并发用户
- 常见操作的响应时间低于 2 秒
- 在注册期间课程选择的高吞吐量
- 高效的数据库查询和缓存机制

**安全需求：**
- 敏感数据的端到端加密
- 使用 2FA 的安全身份验证
- 防止常见 Web 漏洞（XSS、CSRF、SQL 注入）
- 防止滥用的速率限制
- 基于用户角色的访问控制

**可靠性需求：**
- 在注册期间 99.9% 的正常运行时间
- 自动备份和恢复程序
- 数据完整性验证
- 错误处理和日志记录
- 系统监控和警报

**可扩展性需求：**
- 支持服务的水平扩展
- 数据库复制支持
- 跨多个实例的负载分布
- 高峰负载的自动扩展能力

**可维护性需求：**
- 清晰全面的文档
- 具有明确定义接口的模块化架构
- 一致的编码标准
- 全面的测试套件覆盖
- 版本控制和 CI/CD 集成

## 二、课程选择系统设计概要

### 1、设计方法

课程选择系统采用微服务架构模式，这促进了服务之间的松耦合、高内聚和独立部署。每个服务处理特定领域的功能，同时通过明确定义的 API 与其他服务通信。

设计遵循以下关键原则：
- **关注点分离**：每个微服务处理特定域（身份验证、数据管理、队列处理）
- **API 优先设计**：服务通过 RESTful API 和套接字连接通信
- **无状态设计**：服务保持最少状态，依赖外部数据存储
- **弹性**：断路器和重试机制确保系统稳定性
- **安全优先**：身份验证和授权在服务和 API 级别实施

### 2、总体设计

#### 2.1 系统架构

课程选择系统实现了一个五层微服务架构：

**前端层：**
- 基于 Vue3 的单页应用程序
- Ant Design UI 组件以确保一致的用户体验
- 实时通信功能
- 针对各种设备类型的响应式设计

**API 网关层：**
- 具有代理功能的 Vite 开发服务器
- 请求路由和负载平衡
- 跨域资源共享（CORS）处理
- 静态资产服务

**服务层：**
- **数据节点**：课程和学生数据的集中管理
- **身份验证节点**：用户身份验证和会话管理
- **教师服务**：教师特定的课程管理功能
- **学生服务**：学生特定的课程选择功能
- **队列缓冲节点**：速率限制和请求排队

**数据库层：**
- 用于课程和学生数据的主 SQLite 数据库
- 用于用户凭据和令牌的身份验证数据库
- 用于速率限制和任务管理的队列数据库
- 用于数据冗余的主从复制支持

**通信层：**
- HTTP/1.1用于前端到后端通信
- Unix 套接字通信用于后端服务间通信（用于性能）
- 双通信模式以实现最大的兼容性和效率

#### 2.2 技术栈

- **后端框架**：带有 asyncio 支持的 FastAPI（Python）
- **前端框架**：使用组合 API 的 Vue3
- **UI 组件**：Ant Design Vue
- **数据库**：带有 SQLAlchemy ORM 的 SQLite
- **身份验证**：使用 TOTP 的 JWT 令牌和双因素身份验证
- **速率限制**：令牌桶算法实现
- **测试**：用于后端的 Pytest，用于前端的 Jest
- **构建工具**：用于前端的 npm/Yarn，用于后端的 pip/uv

### 3、接口设计

#### 3.1 API 接口设计

该系统实现基于角色的 API 端点，具有明确的关注点分离：

**身份验证端点：**
- `/auth/login` - 用户身份验证
- `/auth/verify-2fa` - 双因素身份验证验证
- `/auth/refresh` - 令牌刷新端点
- `/auth/logout` - 会话终止

**学生端点：**
- `/student/courses` - 可用课程列表
- `/student/enroll` - 课程注册
- `/student/schedule` - 学生时间表检索
- `/student/withdraw` - 课程退选

**教师端点：**
- `/teacher/courses` - 课程管理
- `/teacher/students` - 学生注册管理
- `/teacher/stats` - 课程统计和分析
- `/teacher/import` - 从 CSV 导入学生

**管理员端点：**
- `/admin/users` - 用户管理
- `/admin/generate-code` - 生成注册码
- `/admin/system-status` - 系统健康监控

#### 3.2 数据库接口设计

该系统使用多个 SQLite 数据库，具有明确的分离：
- **数据数据库**：存储课程信息、学生资料、注册记录
- **身份验证数据库**：管理用户凭据、令牌和 2FA 设置
- **队列数据库**：处理速率限制和请求排队

每个数据库都有自己的连接池和为特定用例优化的访问模式。

### 4、系统错误信息设计

该系统实施全面的错误处理，具有标准化的错误响应：

**错误响应格式：**
```json
{
  "error": "错误消息",
  "code": "错误代码",
  "details": "其他错误详情",
  "timestamp": "ISO 8601 时间戳"
}
```

**常见错误代码：**
- `AUTH_001`: 身份验证失败
- `AUTH_002`: 需要 2FA 验证
- `COURSE_001`: 未找到课程
- `COURSE_002`: 课程容量已满
- `RATE_LIMIT_001`: 超出速率限制
- `PERMISSION_001`: 权限不足
- `SYSTEM_001`: 系统错误或维护模式

该系统包括带有上下文信息的自动错误日志记录，并向用户提供有意义的错误消息，同时通过避免信息泄露来维护安全性。

## 三、课程选择系统详细设计

### 1、系统身份验证模块设计

身份验证模块是系统安全的基石，实施两阶段身份验证过程，使用 JWT 令牌和双因素身份验证（2FA）。

#### 1.1 身份验证流程设计

身份验证过程包含两个不同的阶段：

**阶段 1 - 主要身份验证：**
1. 用户提交用户名和密码
2. 系统根据身份验证数据库验证凭据
3. 如果有效，系统生成临时身份验证令牌
4. 系统检查用户角色是否需要 2FA
5. 如果需要 2FA，系统向前端返回"需要 2FA 验证"状态

**阶段 2 - 次要身份验证：**
1. 前端提示用户提供 2FA 代码
2. 用户从验证器应用程序输入 TOTP 代码
3. 系统根据存储的密钥验证 TOTP 代码
4. 如果有效，系统生成完整的 JWT 访问令牌和刷新令牌
5. 用户已进行身份验证并获得相应权限

#### 1.2 JWT 令牌管理

该系统实现了全面的令牌管理系统，具有访问令牌和刷新令牌：

**访问令牌：**
- 短期（默认 15 分钟过期）
- 包含用户 ID、角色和权限
- 用于所有后续 API 请求
- 使用 HS256 算法签名

**刷新令牌：**
- 长期（默认 7 天过期）
- 存储在数据库中，具有撤销功能
- 用于获取新的访问令牌
- 在注销或可疑活动时撤销

#### 1.3 双因素身份验证实施

2FA 系统使用基于时间的一次性密码（TOTP）算法：

1. 用户通过账户设置启用 2FA
2. 系统生成密钥和二维码
3. 用户使用验证器应用程序扫描二维码
4. 系统验证初始代码以确认设置
5. 登录时，用户必须提供密码和 TOTP 代码
6. 系统根据存储的密钥和当前时间窗口验证 TOTP

### 2、主控制菜单模块设计

主控制菜单模块提供基于角色的导航和对适当系统功能的访问。设计确保用户只能看到与其角色相关的选项，同时保持一致且直观的界面。

#### 2.1 基于角色的界面设计

**学生界面：**
- 包含已注册课程和时间表的仪表盘
- 课程浏览和搜索功能
- 课程选择和注册功能
- 时间表查看和管理
- 个人信息设置

**教师界面：**
- 课程管理仪表盘
- 学生注册管理
- 课程创建和修改工具
- 学生名册导入/导出
- 课程性能分析
- 课程时间表管理

**管理员界面：**
- 用户管理仪表盘
- 注册码生成
- 系统配置选项
- 用户活动监控
- 系统健康和状态信息
- 数据库管理工具

#### 2.2 课程信息管理设计

课程信息系统处理课程数据管理的所有方面：

##### （1）课程创建模块设计

课程创建模块允许教师用全面的信息定义新课程：

**必需字段：**
- 课程代码和名称
- 学分
- 教师分配
- 时间表（日期和时间）
- 位置/教室
- 最大容量
- 描述和先修课程

**验证规则：**
- 课程代码必须唯一
- 时间表不能与教师的其他课程冲突
- 容量不能超过房间容量
- 课程时间必须在有效小时内

**处理流程：**
1. 教师访问课程创建界面
2. 系统验证所有必需字段
3. 系统检查时间表冲突
4. 系统在数据库中创建课程记录
5. 系统向学生广播课程可用性

##### （2）课程删除模块设计

课程删除模块处理课程的移除，具有适当的验证：

**删除的前提条件：**
- 课程中没有注册的学生
- 课程当前未在进行中
- 没有依赖项（其他课程的先修课程）

**处理流程：**
1. 教师选择要删除的课程
2. 系统验证前提条件是否满足
3. 系统警告潜在影响
4. 系统删除课程记录并级联效果
5. 系统通知受影响的学生（如果有）

##### （3）课程修改模块设计

课程修改模块允许教师更新课程信息：

**可修改字段：**
- 课程描述
- 时间表和位置
- 容量限制
- 先修课程
- 教师分配（具有适当的授权）

**约束条件：**
- 课程代码不能更改
- 时间表更改不能与教师可用性冲突
- 容量减少不能影响当前注册

**处理流程：**
1. 教师访问课程修改界面
2. 系统验证修改课程的权限
3. 系统验证更新的信息
4. 系统更新课程记录
5. 系统通知已注册的学生更改

##### （4）课程搜索/查询模块设计

课程搜索模块提供全面的课程发现功能：

**搜索条件：**
- 课程代码和名称
- 教师
- 系
- 学分
- 可用座位
- 日期和时间
- 描述中的关键词

**排序选项：**
- 课程代码（升序/降序）
- 注册容量
- 日期和时间
- 剩余座位

**处理流程：**
1. 学生输入搜索条件
2. 系统处理过滤器和约束条件
3. 系统使用优化的 SQL 查询数据库
4. 系统返回分页结果
5. 学生可以查看课程的详细信息

##### （5）CSV 导入模块设计

CSV 导入模块允许对用户管理进行批量操作：

**导入类型：**
- 使用自动生成密码的学生导入
- 具有角色分配的教师导入
- 包含时间表信息的课程导入

**验证过程：**
- 文件格式验证（具有必需列的 CSV）
- 根据模式的数据验证
- 重复检测和处理
- 密码强度和安全检查

**处理流程：**
1. 管理员/教师上传 CSV 文件
2. 系统验证文件格式和内容
3. 系统执行数据验证
4. 系统创建导入操作的预览
5. 用户确认导入
6. 系统在事务安全的情况下执行批量导入

##### （6）课程选择队列模块设计

课程选择队列模块处理高流量期间的公平处理：

**队列机制：**
- 使用令牌桶算法进行速率限制
- FIFO 处理与优先级选项
- 处理资源的公平分配

**处理流程：**
1. 学生提交课程注册请求
2. 系统检查速率限制和可用容量
3. 如果在限制内，请求立即处理
4. 如果超出限制，请求排队
5. 系统按顺序处理排队的请求
6. 学生收到请求的状态更新

##### （7）课程注册模块设计

课程注册模块处理学生选择和注册课程的过程：

**注册验证：**
- 先修课程验证
- 时间表冲突检查
- 容量可用性
- 学生资格和状态

**处理流程：**
1. 学生选择课程进行注册
2. 系统验证所有约束条件
3. 系统检查容量和可用性
4. 系统处理注册请求
5. 系统更新学生时间表
6. 系统向学生发送确认

##### （8）课程退选模块设计

课程退选模块允许学生退选已注册的课程：

**退选约束：**
- 在退选截止日期内
- 没有学术处罚（如适用）
- 退选后没有时间表冲突

**处理流程：**
1. 学生请求课程退选
2. 系统验证退选约束
3. 系统处理退选请求
4. 系统更新学生时间表
5. 系统更新课程容量
6. 系统向学生发送确认

##### （9）用户界面设计

用户界面遵循现代设计原则，具有一致的样式：

**前端技术栈：**
- 使用组合 API 的 Vue3
- 用于状态管理的 Pinia
- 用于构建工具的 Vite
- 用于 UI 组件的 Ant Design Vue
- 用于类型安全的 TypeScript

**响应式设计：**
- 移动优先方法
- 针对平板电脑和桌面的优化布局
- 触摸友好的控件
- 可访问设计实践

### 3、主函数代码实现

主函数代码实现在微服务架构中，每个服务独立运行：

```python
# 数据节点服务的主函数示例
from fastapi import FastAPI
from contextlib import asynccontextmanager
from backend.common.database import get_db_session
from backend.data_node.routers import courses, students
import uvicorn

@asynccontextmanager
async def lifespan(app: FastAPI):
    # 启动逻辑
    await get_db_session()
    yield
    # 关闭逻辑
    pass

app = FastAPI(title="课程选择数据节点", lifespan=lifespan)

app.include_router(courses.router, prefix="/courses", tags=["courses"])
app.include_router(students.router, prefix="/students", tags=["students"])

if __name__ == "__main__":
    uvicorn.run(app, host="0.0.0.0", port=8001)
```

## 四、课程选择系统测试情况

### 1、系统身份验证模块测试

#### 1.1 登录模块测试
- **测试用例 1.1**: 有效凭据身份验证
  - 输入：正确的用户名和密码
  - 预期：使用 JWT 令牌成功身份验证
  - 状态：通过/失败

- **测试用例 1.2**: 无效凭据身份验证
  - 输入：错误的用户名或密码
  - 预期：身份验证失败，显示适当的错误消息
  - 状态：通过/失败

- **测试用例 1.3**: 学生的 2FA 验证
  - 输入：有效的凭据 + 正确的 TOTP 代码
  - 预期：成功身份验证，完全访问
  - 状态：通过/失败

- **测试用例 1.4**: 缺少 2FA 验证
  - 输入：仅有效的凭据（用于学生用户）
  - 预期：需要 2FA 的错误消息
  - 状态：通过/失败

#### 1.2 令牌管理测试
- **测试用例 1.5**: 访问令牌过期
  - 输入：在 API 请求中使用过期的访问令牌
  - 预期：401 未授权响应
  - 状态：通过/失败

- **测试用例 1.6**: 刷新令牌功能
  - 输入：有效的刷新令牌与过期的访问令牌
  - 预期：生成新的访问令牌
  - 状态：通过/失败

- **测试用例 1.7**: 注销时的令牌撤销
  - 输入：使用有效令牌的注销请求
  - 预期：刷新令牌被标记为已撤销
  - 状态：通过/失败

### 2、主菜单模块测试

#### 2.1 导航模块测试
- **测试用例 2.1**: 基于角色的菜单显示
  - 输入：不同用户角色（学生、教师、管理员）
  - 预期：显示适当的菜单选项
  - 状态：通过/失败

- **测试用例 2.2**: 权限访问验证
  - 输入：未授权访问受限页面
  - 预期：访问被拒绝，重定向到登录
  - 状态：通过/失败

#### 2.2 课程信息测试
- **测试用例 2.3**: 课程创建模块
  - 输入：有效的课程信息
  - 预期：课程在数据库中成功创建
  - 状态：通过/失败

- **测试用例 2.4**: 课程修改模块
  - 输入：更新的课程信息
  - 预期：课程信息在数据库中更新
  - 状态：通过/失败

- **测试用例 2.5**: 课程删除模块
  - 输入：没有注册学生参与的课程
  - 预期：课程成功删除
  - 状态：通过/失败

- **测试用例 2.6**: 课程搜索功能
  - 输入：各种搜索条件
  - 预期：精确且快速的搜索结果
  - 状态：通过/失败

#### 2.7 课程文件导入模块测试
- **测试用例 2.7**: 有效的 CSV 导入
  - 输入：格式正确的 CSV 文件
  - 预期：成功导入并处理所有记录
  - 状态：通过/失败

- **测试用例 2.8**: 无效的 CSV 格式
  - 输入：格式错误的 CSV 文件
  - 预期：具有特定验证失败的错误消息
  - 状态：通过/失败

- **测试用例 2.9**: 重复记录处理
  - 输入：包含重复条目的 CSV
  - 预期：适当处理重复项（跳过、合并等）
  - 状态：通过/失败

#### 2.10 课程数据保存模块测试
- **测试用例 2.10**: 数据持久性
  - 输入：课程和学生的操作
  - 预期：所有更改立即保存到数据库
  - 状态：通过/失败

- **测试用例 2.11**: 数据完整性验证
  - 输入：无效的课程数据
  - 预期：验证防止保存无效数据
  - 状态：通过/失败

#### 2.12 课程注册模块测试
- **测试用例 2.12**: 成功注册
  - 输入：有资格的学生的有效课程选择
  - 预期：学生注册，容量更新
  - 状态：通过/失败

- **测试用例 2.13**: 容量限制执行
  - 输入：当课程已满时的注册请求
  - 预期：注册被拒绝，并提供适当的消息
  - 状态：通过/失败

- **测试用例 2.14**: 时间表冲突检测
  - 输入：与学生现有课程有冲突的课程选择
  - 预期：注册被拒绝，并解释冲突
  - 状态：通过/失败

- **测试用例 2.15**: 先修课程验证
  - 输入：没有先修课程的课程注册
  - 预期：注册被拒绝，并列出先修课程
  - 状态：通过/失败

#### 2.16 课程退选模块测试
- **测试用例 2.16**: 截止日期内的有效退选
  - 输入：在允许期间内的课程退选请求
  - 预期：课程已退选，容量已更新
  - 状态：通过/失败

- **测试用例 2.17**: 截止日期执行
  - 输入：超过截止日期的课程退选
  - 预期：退选被拒绝，并解释截止日期
  - 状态：通过/失败

- **测试用例 2.18**: 退选后的时间表冲突解决
  - 输入：解决时间表冲突的课程退选
  - 预期：时间表冲突已解决
  - 状态：通过/失败

#### 2.19 系统数据保存模块测试
- **测试用例 2.19**: 数据库事务完整性
  - 输入：多个并发数据库操作
  - 预期：所有操作成功完成
  - 状态：通过/失败

- **测试用例 2.20**: 备份和恢复
  - 输入：操作期间的系统崩溃模拟
  - 预期：恢复后数据完整性得到维护
  - 状态：通过/失败

#### 2.21 系统退出模块测试
- **测试用例 2.21**: 服务优雅关闭
  - 输入：服务的关闭信号
  - 预期：服务干净地停止，没有数据丢失
  - 状态：通过/失败

- **测试用例 2.22**: 会话清理
  - 输入：用户注销和系统关闭
  - 预期：所有会话正确终止
  - 状态：通过/失败

## 五、课程选择系统优点与改进

### 1、系统优点

#### 1.1 微服务架构优势
- **可扩展性**: 每个服务可以根据需求独立扩展
- **可维护性**: 具有明确定义接口的隔离服务
- **容错能力**: 一个服务的故障不会影响其他服务
- **技术灵活性**: 不同服务如需要可以使用不同技术

#### 1.2 安全特性
- **双因素身份验证**: 除密码外的安全增强
- **JWT 令牌系统**: 安全、无状态的身份验证
- **基于角色的访问控制**: 精确的权限控制
- **速率限制**: 防止滥用和过度使用

#### 1.3 性能优化
- **双重通信模式**: HTTP 用于兼容性，Unix 套接字用于性能
- **连接池**: 高效的数据库连接管理
- **缓存策略**: 减少常见查询的数据库负载
- **异步处理**: 非阻塞操作以获得更好的响应性

#### 1.4 用户体验改进
- **响应式界面**: 适用于各种设备类型
- **实时更新**: 课程可用性的实时通知
- **直观导航**: 针对每个用户类型优化的基于角色的界面
- **无障碍功能**: 支持屏幕阅读器和键盘导航

### 2、系统改进

#### 2.1 性能增强
- **数据库索引**: 使用适当的索引优化查询性能
- **缓存层**: 为频繁访问的数据实现 Redis
- **CDN 集成**: 从边缘位置服务静态资产
- **查询优化**: 分析和优化慢速数据库查询

#### 2.2 安全增强
- **增强输入验证**: 更强大的验证以防止注入攻击
- **审计日志**: 全面记录所有系统操作
- **会话管理**: 改进会话处理和自动清理
- **加密**: 敏感数据传输的端到端加密

#### 2.3 功能扩展
- **移动应用程序**: iOS 和 Android 的原生移动应用
- **高级分析**: 详细的使用和性能分析
- **集成 API**: 与现有教育系统集成的 API
- **自动调度**: AI 驱动的冲突解决和优化

#### 2.4 可靠性改进
- **健康检查**: 全面的服务健康监控
- **自动故障转移**: 无缝切换到备用系统
- **备份自动化**: 带有验证的自动备份程序
- **灾难恢复**: 全面的灾难恢复程序

## 六、感想

课程选择系统代表了为教育机构提供课程注册管理的现代、可扩展的解决方案。通过其微服务架构，该系统在提供高可用性、可扩展性和可维护性的同时，确保了通过 JWT 令牌和双因素身份验证的健壮安全性。

该实现成功地满足了教育机构的复杂需求，为学生、教师和管理员提供了基于角色的访问控制。系统的双重通信模式和速率限制机制在保持安全性和公平性的同时，确保了在高峰期的性能。

通过全面的测试程序，该系统展示了在所有核心模块上的可靠性和功能性。详细的文档提供了对系统架构和实现的清晰理解，有助于未来的维护和增强。

该系统的设计允许持续改进，具有新功能和优化，使其成为教育机构课程选择需求的可持续解决方案。

## 七、附件：课程选择系统处理流程图

```
                    学生登录
                         |
                    [验证凭据]
                         |
                  [如果需要，2FA验证]
                         |
                   [JWT令牌生成]
                         |
                 学生仪表盘可用
                         |
            [浏览/搜索可用课程]
                         |
                 [选择课程请求]
                         |
                [验证约束]
                         |
                 [检查容量]
                         |
              [时间表冲突检查]
                         |
              [处理注册请求]
                         |
                   [更新时间表]
                         |
                   [发送确认]
```

### 附录 B：数据库模式图

```
[用户表]              [课程表]            [注册表]
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│ user_id         │  │ course_id       │  │ enrollment_id   │
│ username        │  │ course_code     │  │ user_id         │
│ password_hash   │  │ course_name     │  │ course_id       │
│ role            │  │ instructor_id   │  │ enrollment_date │
│ email           │  │ credits         │  │ status          │
│ is_2fa_enabled  │  │ schedule        │  └─────────────────┘
│ created_at      │  │ capacity        │
└─────────────────┘  │ enrolled_count  │
                     └─────────────────┘
```

### 附录 C：API 端点参考

- 身份验证端点
  - POST /auth/login
  - POST /auth/verify-2fa
  - POST /auth/refresh
  - POST /auth/logout

- 学生端点
  - GET /student/courses (浏览可用课程)
  - POST /student/enroll (注册课程)
  - GET /student/schedule (查看注册)
  - DELETE /student/withdraw (退课)

- 教师端点
  - GET/POST/PUT/DELETE /teacher/courses (管理课程)
  - GET/POST /teacher/students (管理学生)
  - POST /teacher/import (从 CSV 导入)

- 管理员端点
  - GET/POST/PUT/DELETE /admin/users (管理用户)
  - POST /admin/generate-code (注册码)
  - GET /admin/system-status (系统健康)

这份全面的文档提供了课程选择系统的完整概述，从需求分析到实现细节、测试程序和未来的改进机会。

---

**文档创建**: 2025 年 11 月 3 日  
**文档版本**: 1.0  
**系统版本**: 2.0 (带双重 HTTP + socket 通信)